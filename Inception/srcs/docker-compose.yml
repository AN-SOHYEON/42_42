
version: "3"

services:
  mariadb:
    container_name: mariadb
    build: ./requirements/mariadb
    image: mariadb
    env_file:
        - .env
    volumes:
      - mariadb:/var/lib/mysql
    networks:
      - inception_net
    restart: always
    tty: true

  nginx:
    container_name: nginx
    build: ./requirements/nginx/
    image: nginx
    depends_on:
      - mariadb
    ports:
      - "443:443"
    volumes:
      - wordpress:/var/www/html
    env_file: 
      - .env
    networks:
      - inception_net
    #restart: always
    tty: true

  wordpress:
    container_name: wordpress
    build: ./requirements/wordpress
    image: wordpress
    depends_on:
      - mariadb
    expose: 
      - "9000"
    volumes:
      - wordpress:/var/www/html
    env_file:
      - .env
    networks:
      - inception_net
    restart: always
    tty: true

networks:
  inception_net: {}

volumes:
  wordpress:
    driver: local
    driver_opts:
      type: volume
      o: bind
      device: /home/san/data/wordpress
  mariadb:
    driver: local
    driver_opts:
      type: volume
      o: bind
      device: /home/san/data/mariadb
  

# network
# https://www.daleseo.com/docker-compose-networks/



# 클라이언트가 https로 index.html을 서버에 요청
# 서버의 443포트에 대기중이던 nginx프로세스가 클라이언트릐 요청 수신
# nginx precess는 config파일에 기재된 파일을 클라이언트에 반환
  # 만약 php파일일 경유, config 파일에 기재된 php-fpm프로세스의 포트로 Php를 넘김
  # php-fpm은 php템플릿 엔진을 이용하여 php파일을 html파일로 변환
    # index.php파일에 inmport된 wp-config.php파일에 기재된 내용을 이용하여 필요시 mysql에 접근하여 데이터를 가져옴
  # php-fpm은 html파일을 엔진엑스에게 넘겨줌
  # 엔진엑스는 클라이언트에게 index.html피일을 반혼
